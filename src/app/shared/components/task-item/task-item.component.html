<mat-card class="task-card" [class.completed]="task.completed">
  <div class="task-card-content" *ngIf="!isEditing">
    <mat-checkbox
      [checked]="task.completed"
      (change)="onToggleCompleted()"
      class="task-checkbox">
    </mat-checkbox>

    <div class="task-text">
      <div class="task-title">
        {{ task.title }}
      </div>
      <div class="task-description" *ngIf="task.description">
        {{ task.description }}
      </div>
      <small class="task-meta">
        Creada: {{ task.createdAt | date: 'short' }}
      </small>
    </div>

    <div class="task-actions">
      <button mat-icon-button (click)="startEdit()" aria-label="Editar tarea">
        <mat-icon>edit</mat-icon>
      </button>
      <button mat-icon-button color="warn" (click)="onDelete()" aria-label="Eliminar tarea">
        <mat-icon>delete</mat-icon>
      </button>
    </div>
  </div>

  <div class="task-card-content" *ngIf="isEditing">
    <form [formGroup]="editForm" class="edit-form">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Título</mat-label>
        <input matInput formControlName="title" />
        <mat-error *ngIf="editForm.get('title')?.hasError('required')">
          El título es obligatorio.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Descripción</mat-label>
        <textarea matInput rows="2" formControlName="description"></textarea>
      </mat-form-field>

      <div class="edit-actions">
        <button mat-button type="button" (click)="cancelEdit()">
          Cancelar
        </button>
        <button mat-flat-button color="primary" type="button" (click)="saveEdit()">
          Guardar
        </button>
      </div>
    </form>
  </div>
</mat-card>
